{"version":3,"sources":["server/routes/plugins/chrome-extension/main.ts"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["\n//[REFACTOR]: big refaktor\n//[TODO]: Menu options\n//[TODO]: CSS better\n\ndocument.addEventListener('DOMContentLoaded',function(){\n\n  (function(){\n\n    var extension = {\n      API : 'http://<<<O>>>HOST<<<O>>>/api',\n      API_LOGIN: '/service/login',\n      API_ARCHIVE: '/archive/extensions',\n      KEY : 'JOME_TOKEN',\n      TOKEN : null,\n\n      $status : null,\n      $title : null,\n      $archives : null,\n      $btnLogin : null,\n      $btnAdd : null,\n      $btnRev : null,\n      $loader : null,\n      $login : null,\n      $password : null,\n      $divTitle : null,\n      $divLogin : null,\n      $divPassword : null,\n      $divArchive : null,\n\n      init : null,\n      getDataTab : null,\n      setupElements : null,\n      setupEvents: null,\n      getToken : null,\n      setToken : null,\n      revToken : null,\n      httpService : null,\n      loadingON : null,\n      loadingOFF : null,\n      loginState : null,\n      readyState : null,\n\n      afterFetchArchive: null\n    };\n\n    extension.init = function () {\n      this.TOKEN = this.getToken();\n      this.setupElements();\n      this.setupEvents();\n      if (this.TOKEN)\n      {\n        this.readyState();\n      }\n      else\n      {\n        this.loginState();\n      }\n      console.warn('INIT_EXTENSION');\n    };\n\n    extension.afterFetchArchive = function (archiveData) {\n      for (var i = 0; i < archiveData.length; ++i)\n      {\n        var option = document.createElement(\"option\");\n        option.setAttribute(\"value\", archiveData[i].value);\n        option.innerHTML = archiveData[i].name;\n        extension.$archives.appendChild(option);\n      }\n      if (localStorage.getItem('lastArchive'))\n        extension.$archives.value = localStorage.getItem('lastArchive');\n      extension.loadingOFF('Ready');\n    };\n\n    extension.getDataTab = function (callback) {\n      chrome.tabs.getSelected(null, function (tab) {\n        if (callback) callback({ title: tab.title, url: tab.url });\n      });\n    }\n\n    extension.loginState = function () {\n      this.$divTitle.style.display = \"none\";\n      this.$divArchive.style.display = \"none\";\n      this.$btnAdd.style.display = \"none\";\n      this.$btnRev.style.display = \"none\";\n      this.$btnLogin.style.display = \"block\";\n      this.$divLogin.style.display = \"block\";\n      this.$divPassword.style.display = \"block\";\n      extension.loadingOFF('Please login');\n\n    };\n\n    extension.readyState = function () {\n      this.$divTitle.style.display = \"block\";\n      this.$divArchive.style.display = \"block\";\n      this.$btnAdd.style.display = \"block\";\n      this.$btnRev.style.display = \"block\";\n      this.$btnLogin.style.display = \"none\";\n      this.$divLogin.style.display = \"none\";\n      this.$divPassword.style.display = \"none\";\n      extension.httpService({\n        url: extension.API + extension.API_ARCHIVE,\n        method: 'get',\n        callback : extension.afterFetchArchive\n      });\n    };\n\n    extension.setupElements = function () {\n      extension.$status = document.getElementById('statusSpan');\n      extension.$title = document.getElementById('titleInput');\n      extension.$archives = document.getElementById('archivesSelect');\n      extension.$btnLogin = document.getElementById('loginButton');\n      extension.$btnAdd = document.getElementById('addButton');\n      extension.$btnRev = document.getElementById('revButton');\n      extension.$loader = document.getElementById('loadingImg');\n      extension.$login = document.getElementById('loginInput');\n      extension.$password = document.getElementById('passwordInput');\n      extension.$divTitle = document.getElementById('titleDiv');\n      extension.$divLogin = document.getElementById('loginDiv');\n      extension.$divPassword = document.getElementById('passwordDiv');\n      extension.$divArchive = document.getElementById('archiveDiv');\n    };\n\n    extension.setupEvents = function () {\n      this.$btnLogin.addEventListener(\"click\", function(){\n        if (!extension.$login.value || !extension.$password.value) return;\n        extension.loadingON();\n        extension.httpService({\n          url: extension.API + extension.API_LOGIN,\n          method: 'post',\n          withoutAuthorization: true,\n          params: {\n            'login': extension.$login.value,\n            'password': extension.$password.value\n          },\n          callback : function (response) {\n            if (response.type)\n            {\n              extension.loadingON();\n              extension.setToken(response.data.token);\n              extension.readyState();\n            }\n            else\n            {\n              extension.loadingOFF('Wrong Auth');\n            }\n          }\n        });\n      });\n\n      this.$btnAdd.addEventListener(\"click\", function(){\n        extension.loadingON();\n        extension.getDataTab(function(tabData){\n          extension.httpService({\n            url: extension.API + extension.API_ARCHIVE + '/' + extension.$archives.value,\n            method: 'post',\n            params: {\n              title: (extension.$title.value)?(extension.$title.value):(tabData.title),\n              link: tabData.url\n            },\n            callback : function (response) {\n              if (response.type === 'NOTE_ADDED')\n              {\n                localStorage.setItem('lastArchive', extension.$archives.value);\n                extension.loadingOFF('Added');\n              }\n            }\n          });\n\n        });\n      });\n\n      this.$btnRev.addEventListener(\"click\", function(){\n        extension.revToken();\n        extension.loginState();\n      });\n    };\n\n    extension.setToken = function (token: string) {\n      localStorage.setItem(<string>this.KEY,token);\n    };\n\n    extension.getToken = function () {\n      try\n      {\n        return localStorage.getItem(this.KEY);\n      }\n      catch (error)\n      {\n        //[TODO]: ERROR MANAGEMENT\n        console.log(error.toString());\n        return null;\n      }\n    };\n\n    extension.revToken = function () {\n      localStorage.removeItem(this.KEY);\n    };\n\n    extension.loadingON = function () {\n      this.$loader.style.display = \"block\";\n      this.$status.style.display = \"none\";\n    };\n\n    extension.loadingOFF = function (status) {\n      this.$loader.style.display = \"none\";\n      this.$status.style.display = \"block\";\n      this.$status.innerHTML = status;\n    };\n\n    extension.httpService = function (params) {\n      var xhr = new XMLHttpRequest();\n      xhr.onload = function () {\n        try\n        {\n          if (params.callback)\n            params.callback((<any>this).response);\n        }\n        catch(error)\n        {\n          //[TODO]: ERROR MANAGEMENT\n          console.log(error.toString());\n        }\n      };\n      xhr.open(params.method, params.url);\n      if (!params.withoutAuthorization)\n        xhr.setRequestHeader('Authorization', extension.TOKEN);\n      xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n      xhr.responseType = \"json\";\n      xhr.send(JSON.stringify(params.params));\n    };\n\n    extension.init();\n\n\t})();\n});\n"]}